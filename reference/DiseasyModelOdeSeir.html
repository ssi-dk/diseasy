<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>A flexible SEIR model template — DiseasyModelOdeSeir • diseasy</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A flexible SEIR model template — DiseasyModelOdeSeir"><meta name="description" content="This class provides a diseasy model-template for a compartmental SEIR ordinary differential equation model.
The number of consecutive exposed, infectious, and recovered compartments can flexibly be specified to generate a
number of structurally different SEIR models.
Similarly, the number of age groups in the model can also be controlled to create structurally different models.
The model implements the following features:
A scaling of infection risk based on season (via DiseasySeason)
Contact matrices and activity scenarios (via DiseasyActivity)
Waning of immunity (via DiseasyImmunity)
Asymmetric cross-immunity interactions between variants (via DiseasyVariant)


See vignette(diseasy-model-ode-seir) for a detailed examples of how to use this model."><meta property="og:description" content="This class provides a diseasy model-template for a compartmental SEIR ordinary differential equation model.
The number of consecutive exposed, infectious, and recovered compartments can flexibly be specified to generate a
number of structurally different SEIR models.
Similarly, the number of age groups in the model can also be controlled to create structurally different models.
The model implements the following features:
A scaling of infection risk based on season (via DiseasySeason)
Contact matrices and activity scenarios (via DiseasyActivity)
Waning of immunity (via DiseasyImmunity)
Asymmetric cross-immunity interactions between variants (via DiseasyVariant)


See vignette(diseasy-model-ode-seir) for a detailed examples of how to use this model."><meta property="og:image" content="https://ssi-dk.github.io/diseasy/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">diseasy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/diseasy.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Creating ensembles</h6></li>
    <li><a class="dropdown-item" href="../articles/creating-ensembles.html">Creating ensembles</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Functional modules</h6></li>
    <li><a class="dropdown-item" href="../articles/diseasy-activity.html">DiseasyActivity</a></li>
    <li><a class="dropdown-item" href="../articles/diseasy-immunity.html">DiseasyImmunity</a></li>
    <li><a class="dropdown-item" href="../articles/diseasy-observables.html">DiseasyObservables</a></li>
    <li><a class="dropdown-item" href="../articles/diseasy-season.html">DiseasySeason</a></li>
    <li><a class="dropdown-item" href="../articles/diseasy-variant.html">DiseasyVariant</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Model templates</h6></li>
    <li><a class="dropdown-item" href="../articles/diseasy-model-ode.html">DiseasyModelOde</a></li>
    <li><a class="dropdown-item" href="../articles/diseasy-model-regression.html">DiseasyModelRegression</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developer guides</h6></li>
    <li><a class="dropdown-item" href="../articles/creating-a-model.html">Creating a model</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Model notes</h6></li>
    <li><a class="dropdown-item" href="../articles/SEIR-implementation.html">SEIR: Implementation</a></li>
    <li><a class="dropdown-item" href="../articles/SEIR-initialisation.html">SEIR: Initialising from incidence data</a></li>
    <li><a class="dropdown-item" href="../articles/SEIR-malthusian-matching.html">SEIR: Accounting for structural differences in malthusian growth rates</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Additional information</h6></li>
    <li><a class="dropdown-item" href="../articles/diseasy-immunity-optimisation.html">DiseasyImmunity optimisation</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ssi-dk/diseasy/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>A flexible SEIR model template</h1>
      <small class="dont-index">Source: <a href="https://github.com/ssi-dk/diseasy/blob/main/R/DiseasyModelOdeSeir.R" class="external-link"><code>R/DiseasyModelOdeSeir.R</code></a></small>
      <div class="d-none name"><code>DiseasyModelOdeSeir.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This class provides a <code>diseasy</code> model-template for a compartmental SEIR ordinary differential equation model.
The number of consecutive exposed, infectious, and recovered compartments can flexibly be specified to generate a
number of structurally different SEIR models.</p>
<p>Similarly, the number of age groups in the model can also be controlled to create structurally different models.</p>
<p>The model implements the following features:</p><ul><li><p>A scaling of infection risk based on season (via <code>DiseasySeason</code>)</p></li>
<li><p>Contact matrices and activity scenarios (via <code>DiseasyActivity</code>)</p></li>
<li><p>Waning of immunity (via <code>DiseasyImmunity</code>)</p></li>
<li><p>Asymmetric cross-immunity interactions between variants (via <code>DiseasyVariant</code>)</p></li>
</ul><p>See <code>vignette(diseasy-model-ode-seir)</code> for a detailed examples of how to use this model.</p>
    </div>


    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A new instance of the <code>DiseasyModelOdeSeir</code> <a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6</a> class.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="DiseasyObservables.html">DiseasyObservables</a></p></div>
    </div>
    <div class="section level2">
    <h2 id="super-classes">Super classes<a class="anchor" aria-label="anchor" href="#super-classes"></a></h2>
    <p><code><a href="DiseasyBaseModule.html">diseasy::DiseasyBaseModule</a></code> -&gt; <code><a href="DiseasyModel.html">diseasy::DiseasyModel</a></code> -&gt; <code><a href="DiseasyModelOde.html">diseasy::DiseasyModelOde</a></code> -&gt; <code>DiseasyModelOdeSeir</code></p>
    </div>
    <div class="section level2">
    <h2 id="active-bindings">Active bindings<a class="anchor" aria-label="anchor" href="#active-bindings"></a></h2>
    <p></p><div class="r6-active-bindings"><dl><dt><code>malthusian_scaling_factor</code></dt>
<dd><p>(<code>numeric(1)</code>)<br>
A scaling factor to apply to the contact matrices to account for structural differences
in the model. Read only.</p></dd>


</dl><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-DiseasyModelOdeSeir-new"><code>DiseasyModelOdeSeir$new()</code></a></p></li>
<li><p><a href="#method-DiseasyModelOdeSeir-load_module"><code>DiseasyModelOdeSeir$load_module()</code></a></p></li>
<li><p><a href="#method-DiseasyModelOdeSeir-get_results"><code>DiseasyModelOdeSeir$get_results()</code></a></p></li>
<li><p><a href="#method-DiseasyModelOdeSeir-prepare_rhs"><code>DiseasyModelOdeSeir$prepare_rhs()</code></a></p></li>
<li><p><a href="#method-DiseasyModelOdeSeir-set_forcing_functions"><code>DiseasyModelOdeSeir$set_forcing_functions()</code></a></p></li>
<li><p><a href="#method-DiseasyModelOdeSeir-malthusian_growth_rate"><code>DiseasyModelOdeSeir$malthusian_growth_rate()</code></a></p></li>
<li><p><a href="#method-DiseasyModelOdeSeir-initialise_state_vector"><code>DiseasyModelOdeSeir$initialise_state_vector()</code></a></p></li>
<li><p><a href="#method-DiseasyModelOdeSeir-rhs"><code>DiseasyModelOdeSeir$rhs()</code></a></p></li>
<li><p><a href="#method-DiseasyModelOdeSeir-clone"><code>DiseasyModelOdeSeir$clone()</code></a></p></li>
</ul></div><p><details open><summary>Inherited methods</summary><ul><li><span class="pkg-link" data-pkg="diseasy" data-topic="DiseasyBaseModule" data-id="set_moduleowner"><a href="DiseasyBaseModule.html#method-set_moduleowner"><code>diseasy::DiseasyBaseModule$set_moduleowner()</code></a></span></li>
<li><span class="pkg-link" data-pkg="diseasy" data-topic="DiseasyModel" data-id="get_data"><a href="DiseasyModel.html#method-get_data"><code>diseasy::DiseasyModel$get_data()</code></a></span></li>
<li><span class="pkg-link" data-pkg="diseasy" data-topic="DiseasyModelOde" data-id="plot"><a href="DiseasyModelOde.html#method-plot"><code>diseasy::DiseasyModelOde$plot()</code></a></span></li>
</ul></details></p><hr><a id="method-DiseasyModelOdeSeir-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Creates a new instance of the <code>DiseasyModelOdeSeir</code> <a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6</a> class.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/DiseasyModelOdeSeir.html">DiseasyModelOdeSeir</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  observables <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  activity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  season <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  variant <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  immunity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parameters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>observables, activity, season, variant, immunity</code></dt>
<dd><p>(<code>boolean</code> or <code>R6::R6Class instance</code>)<br> If a boolean is given, it dictates whether to load a new instance module of this class.<br> If an instance of the module is provided instead, a copy of this instance is added to the <code>DiseasyModel</code> instance. This copy is a "clone" of the instance at the time it is added and any subsequent changes to the instance will not reflect in the copy that is added to <code>DiseasyModel</code>.</p></dd>


<dt><code>parameters</code></dt>
<dd><p>(<code>named list()</code>)<br>
List of parameters to set for the model during initialization.</p>
<p>Parameters controlling the structure of the model:</p><ul><li><p><code>compartment_structure</code> (<code>named integer()</code>)<br> The structure of the compartments in the model. The names should be <code>E</code>, <code>I</code>, and <code>R</code> for the exposed, infectious, and recovered compartments, respectively. The exposed compartments can optionally be omitted.</p></li>
<li><p><code>age_cuts_lower</code> (<code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code>)<br>
Determines the age groups in the model.</p></li>
<li><p><code>malthusian_matching</code> (<code>logical(1)</code>)<br>
Should the model be scaled such the Malthusian growth rate matches the corresponding SIR model?</p></li>
</ul><p>Parameters controlling the dynamics of the model:</p><ul><li><p><code>overall_infection_risk</code> (<code>numeric(1)</code>)<br>
A scalar that scales contact rates to infection rates.</p></li>
<li><p><code>disease_progression_rates</code> (<code>named numeric()</code>)<br> The overall progression rates for the disease states. The reciprocal of each rate is the average time spent in the all of the corresponding compartments. The exposed compartments can optionally be omitted.</p></li>
</ul><p>Parameters controlling initialisation routines</p><ul><li><p><code>incidence_polynomial_order</code> (<code>integer(1)</code>)<br>
The degree of the polynomial to fit to the incidence curves.</p></li>
<li><p><code>incidence_polynomial_training_length</code> (<code>integer(1)</code>)<br>
The number of days to include in the incidence polynomial fit.</p></li>
<li><p><code>incidence_max_order_derivatives</code> (<code>integer(1)</code>)<br>
The highest (informed) derivative from incidence data.
Higher order derivatives are set to zero.</p></li>
</ul><p>Parameters controlling the functional modules:</p><ul><li><p><code>activity.weights</code> (<code>numeric(4)</code>)<br>
Passed to <code>?DiseasyActivity$get_scenario_contacts(..., weights = activity.weights)</code></p></li>
<li><p><code>immunity.approximate_compartmental_args</code> (<code>named list()</code>)<br>
Arguments passed to <code><a href=".{2}/reference/DiseasyImmunity.html#method-DiseasyImmunity-approximate_compartmental">$approximate_compartmental()</a></code></p></li>
</ul><p>Additional parameters are:</p><ul><li><p><code>training_length</code> (<code>named numeric(3)</code>)<br>   The number of days that should be included in the training splits of the data for the model.   Allowed splits are: "training", "testing", and "validation".</p></li>
<li><p><code>incidence_feature_name</code> (<code>character(1)</code>)<br>   The name of the observable that contains the incidence data to initialise from.  * <code>model_rate_to_observable</code> (<code>named list</code>(<code>named list</code>(<code>function</code>(2))))<br>   A named list of functions that maps the model rates to the observable in question (name).   Each observable needs a <code>map</code> and <code>reduce</code> function contained in a list (the first nested list).   The <code>map</code> function is applied in a <code><a href="https://dplyr.tidyverse.org/reference/group_map.html" class="external-link">dplyr::group_map()</a></code> call and should take two arguments:   - The first argument contains the model <code>rate</code> and information about group size: <code>proportion</code> and <code>population</code>.   - The second argument contains the groups (stratification).   The <code>reduce</code> function is applied in a <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise()</a></code> call to summarise across stratification levels.   By default, the <code>sum</code> function is used and will work for all counting observables.</p></li>
</ul></dd>


<dt><code>...</code></dt>
<dd><p>Parameters sent to <code>DiseasyModel</code> <a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6</a> constructor.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-DiseasyModelOdeSeir-load_module"></a><div class="section">
<h3 id="method-load-module-">Method <code>load_module()</code><a class="anchor" aria-label="anchor" href="#method-load-module-"></a></h3>
<p>Overload the <code>$load_module()</code> to re-initialise the helpers after loading</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">load_module</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Arguments sent to parent method.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-DiseasyModelOdeSeir-get_results"></a><div class="section">
<h3 id="method-get-results-">Method <code>get_results()</code><a class="anchor" aria-label="anchor" href="#method-get-results-"></a></h3>
<p>The primary method used to request model results of a given observable at a given stratification</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">get_results</span><span class="op">(</span></span>
<span>  <span class="va">observable</span>,</span>
<span>  <span class="va">prediction_length</span>,</span>
<span>  quantiles <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stratification <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>observable</code></dt>
<dd><p>(<code>character</code>)<br> The observable to provide data or prediction for.</p></dd>


<dt><code>prediction_length</code></dt>
<dd><p>(<code>numeric</code>)<br> The number of days to predict. The prediction start is defined by <code>last_queryable_date</code> of the <code><a href="DiseasyObservables.html">?DiseasyObservables</a></code> <a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6</a> class.</p></dd>


<dt><code>quantiles</code></dt>
<dd><p>(<code>list</code>(<code>numeric</code>))<br> If given, results are returned at the quantiles given.</p></dd>


<dt><code>stratification</code></dt>
<dd><p>(<code>list</code>(<code>quosures</code>) or <code>NULL</code>)<br> Use <code>rlang::quos(...)</code> to specify stratification. If given, expressions in stratification evaluated to give the stratification level.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A <code>tibble</code> <a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble::tibble</a> with predictions at the level specified by stratification level. In addition to stratification columns, the output has the columns:<br><br>  - date (<code>Date</code>) specifying the date of the prediction.<br>  - realisation_id (<code>character</code>) giving a unique id for each realization in the ensemble.<br>  - weight (<code>numeric</code>) giving the weight of the realization in the ensemble.</p>
</div>

</div><p></p><hr><a id="method-DiseasyModelOdeSeir-prepare_rhs"></a><div class="section">
<h3 id="method-prepare-rhs-">Method <code>prepare_rhs()</code><a class="anchor" aria-label="anchor" href="#method-prepare-rhs-"></a></h3>
<p>Allocate the helpers for the rhs method</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">prepare_rhs</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-DiseasyModelOdeSeir-set_forcing_functions"></a><div class="section">
<h3 id="method-set-forcing-functions-">Method <code>set_forcing_functions()</code><a class="anchor" aria-label="anchor" href="#method-set-forcing-functions-"></a></h3>
<p>Set the forcing functions for the model.</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">set_forcing_functions</span><span class="op">(</span></span>
<span>  infected_forcing <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  state_vector_forcing <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>infected_forcing</code></dt>
<dd><p>(<code>function</code>)<br>
A function that takes arguments <code>t</code> and <code>infected</code> and modifies the number of infected at time <code>t</code>.</p></dd>


<dt><code>state_vector_forcing</code></dt>
<dd><p>(<code>function</code>)<br>
A function that takes arguments <code>t</code> and<code>dy_dt</code> and modifies the flow into the
compartments at time <code>t</code>.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p><code>NULL</code> (called for side effects)</p>
</div>

</div><p></p><hr><a id="method-DiseasyModelOdeSeir-malthusian_growth_rate"></a><div class="section">
<h3 id="method-malthusian-growth-rate-">Method <code>malthusian_growth_rate()</code><a class="anchor" aria-label="anchor" href="#method-malthusian-growth-rate-"></a></h3>
<p>This function computes the Malthusian growth rate for the given model configuration.</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">malthusian_growth_rate</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Parameters passed to <code>$generator_matrix()</code>.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h4>
<p>This section follows the method outlined in doi: 10.1098/rsif.2009.0386
To compute the scaling, we need to compute the Jacobian matrix of the linearised system.
Here, we linearise around S = 1.
In this limit, there is no interaction with variants (since everyone is susceptible).
The Malthusian growth rate is therefore not dependent on factors such as cross-immunity.</p>
</div>

<div class="section">
<h4 id="returns-2">Returns<a class="anchor" aria-label="anchor" href="#returns-2"></a></h4>
<p>(<code>numeric(1)</code>)<br>
The Malthusian growth rate for the model.</p>
</div>

</div><p></p><hr><a id="method-DiseasyModelOdeSeir-initialise_state_vector"></a><div class="section">
<h3 id="method-initialise-state-vector-">Method <code>initialise_state_vector()</code><a class="anchor" aria-label="anchor" href="#method-initialise-state-vector-"></a></h3>
<p>Infer the state_vector from incidence data</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">initialise_state_vector</span><span class="op">(</span></span>
<span>  <span class="va">incidence_data</span>,</span>
<span>  overall_infection_risk <span class="op">=</span> <span class="va">self</span> <span class="op">%.%</span> <span class="va">parameters</span> <span class="op">%.%</span> <span class="va">overall_infection_risk</span>,</span>
<span>  ei_rs_balance <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"derivative"</span>, <span class="st">"eigen-value"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>incidence_data</code></dt>
<dd><p>incidence_data (<code>data.frame</code>)<br> Incidence observations as a <code>data.frame</code> with columns - <code>date</code>: The date of the observations - <code>age_group</code>: The age group of the incidence observation (following <code><a href="https://ssi-dk.github.io/diseasystore/reference/age_labels.html">diseasystore::age_labels()</a></code> format) - <code>variant</code>: The variant of the incidence observation. - <code>incidence</code>: The incidence in the age group at the given date</p></dd>


<dt><code>overall_infection_risk</code></dt>
<dd><p>(<code>numeric</code>)<br> The overall multiplier for the infection risk for the model.</p></dd>


<dt><code>ei_rs_balance</code></dt>
<dd><p>(<code>numeric(1)</code>)<br>
Which estimate should be priorities when normalising? See details.</p></dd>


<dt><code>method</code></dt>
<dd><p>(<code>character(1)</code>)<br>
The method to use for initialising the state vector.</p><ul><li><p><code>derivative</code>: Directly infers the EI compartments from derivatives of the incidence signal.</p></li>
<li><p><code>eigen-value</code>: Uses the eigenvalues of the generator matrix to infer the state vector.</p></li>
</ul><p>See the article <code>SEIR-initialisation</code> in the online documentation for more information.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="details-1">Details<a class="anchor" aria-label="anchor" href="#details-1"></a></h4>
<p>The inference of the state_vector from incidence data is two-fold: EI states are inferred with one method and
the RS states are inferred with another. The methods are described in detail in the initialisation article
<code>vignette("SEIR-initialisation")</code>.</p>
<p>When these estimates are combined, there is a degree of freedom in how to weight the estimates when
normalising the state vector. This is controlled by the <code>ei_rs_balance</code> parameter.
If <code>ei_rs_balance = 1</code>, the estimate for EI states are prioritised, and only the RS states are modified.
If <code>ei_rs_balance = 0</code>, the estimate for RS states are prioritised.</p>
</div>

<div class="section">
<h4 id="returns-3">Returns<a class="anchor" aria-label="anchor" href="#returns-3"></a></h4>
<p>(<code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code>)<br>
The initial state vector for the model (invisibly).</p>
</div>

</div><p></p><hr><a id="method-DiseasyModelOdeSeir-rhs"></a><div class="section">
<h3 id="method-rhs-">Method <code>rhs()</code><a class="anchor" aria-label="anchor" href="#method-rhs-"></a></h3>
<p>The vectorised right hand side (RHS) function of the system of differential equations</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">rhs</span><span class="op">(</span></span>
<span>  <span class="va">t</span>,</span>
<span>  <span class="va">state_vector</span>,</span>
<span>  parms <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overall_infection_risk <span class="op">=</span> <span class="va">self</span> <span class="op">%.%</span> <span class="va">parameters</span> <span class="op">%.%</span> <span class="va">overall_infection_risk</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>t</code></dt>
<dd><p>(<code>numeric(1)</code>)<br>
The time to solve for.</p></dd>


<dt><code>state_vector</code></dt>
<dd><p>(<code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code>)<br>
The state vector to compute the RHS from.</p></dd>


<dt><code>parms</code></dt>
<dd><p>(<code>list</code>)<br>
Argument to comply with <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">deSolve::ode</a></code> format. Not used.</p></dd>


<dt><code>overall_infection_risk</code></dt>
<dd><p>(<code>numeric</code>)<br> The overall multiplier for the infection risk for the model.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-4">Returns<a class="anchor" aria-label="anchor" href="#returns-4"></a></h4>
<p>(<code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric()</a></code>)<br>
The rate of change for the differential equations.</p>
</div>

</div><p></p><hr><a id="method-DiseasyModelOdeSeir-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>  <span class="co"># The model can be instantiated almost without arguments, but</span></span></span>
<span class="r-in"><span>  <span class="co"># to illustrate its use, we configure a simple model:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># First, we add a observables modules with example data bundled</span></span></span>
<span class="r-in"><span>  <span class="co"># with the package.</span></span></span>
<span class="r-in"><span>  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="va"><a href="DiseasyObservables.html">DiseasyObservables</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span></span>
<span class="r-in"><span>    diseasystore <span class="op">=</span> <span class="va">DiseasystoreSeirExample</span>,</span></span>
<span class="r-in"><span>    conn <span class="op">=</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The observables module also defines the time if interest via</span></span></span>
<span class="r-in"><span>  <span class="co"># the `last_queryable_date` field. Data before this date are</span></span></span>
<span class="r-in"><span>  <span class="co"># used to train the models, and predictions start on this date.</span></span></span>
<span class="r-in"><span>  <span class="va">obs</span><span class="op">$</span><span class="fu">set_last_queryable_date</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-02-29"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Define the incidence data to initialise the model</span></span></span>
<span class="r-in"><span>  <span class="va">obs</span><span class="op">$</span><span class="fu">define_synthetic_observable</span><span class="op">(</span></span></span>
<span class="r-in"><span>    name <span class="op">=</span> <span class="st">"incidence"</span>,</span></span>
<span class="r-in"><span>    mapping <span class="op">=</span> \<span class="op">(</span><span class="va">n_positive</span>, <span class="va">n_population</span><span class="op">)</span> <span class="va">n_positive</span> <span class="op">/</span> <span class="op">(</span><span class="va">n_population</span> <span class="op">*</span> <span class="fl">0.65</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The example data uses a simple activity scenario for Denmark,</span></span></span>
<span class="r-in"><span>  <span class="co"># which we replicate here</span></span></span>
<span class="r-in"><span>  <span class="va">act</span> <span class="op">&lt;-</span> <span class="va"><a href="DiseasyActivity.html">DiseasyActivity</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>contact_basis <span class="op">=</span> <span class="va">contact_basis</span><span class="op">$</span><span class="va">DK</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">act</span><span class="op">$</span><span class="fu">set_activity_units</span><span class="op">(</span><span class="va">dk_activity_units</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">act</span><span class="op">$</span><span class="fu">change_activity</span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, opening <span class="op">=</span> <span class="st">"baseline"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># We create a simple model instance</span></span></span>
<span class="r-in"><span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">DiseasyModelOdeSeir</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span></span>
<span class="r-in"><span>    observables <span class="op">=</span> <span class="va">obs</span>,</span></span>
<span class="r-in"><span>    activity <span class="op">=</span> <span class="va">act</span>,</span></span>
<span class="r-in"><span>    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"age_cuts_lower"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, <span class="fl">60</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      <span class="st">"overall_infection_risk"</span> <span class="op">=</span> <span class="fl">0.025</span>,</span></span>
<span class="r-in"><span>      <span class="st">"disease_progression_rates"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"E"</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span>, <span class="st">"I"</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Run the model to predict incidence</span></span></span>
<span class="r-in"><span>  <span class="va">prediction</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="fu">get_results</span><span class="op">(</span><span class="st">"incidence"</span>, prediction_length <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prediction</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   date       incidence realisation_id weight</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 2020-03-01   0.005<span style="text-decoration: underline;">30</span>              1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 2020-03-02   0.005<span style="text-decoration: underline;">49</span>              1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> 2020-03-03   0.005<span style="text-decoration: underline;">68</span>              1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> 2020-03-04   0.005<span style="text-decoration: underline;">86</span>              1      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> 2020-03-05   0.006<span style="text-decoration: underline;">03</span>              1      1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Plot the results</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">m</span>, observable <span class="op">=</span> <span class="st">"incidence"</span>, prediction_length <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="DiseasyModelOdeSeir-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">act</span>, <span class="va">obs</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rasmus Skytte Randløv, Marcus Munch Grünewald, Lasse Engbo Christiansen, Kaare Græsbøll, Sofia Myrup Otero, <a href="https://www.ssi.dk/" class="external-link"><img src="https://www.ssi.dk/assets/images/ssi-logo-optimeret.svg" alt="SSI" height="64" style="margin-bottom: 0.5em; margin-top: 1.5em;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

